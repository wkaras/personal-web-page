<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=iso-8859-1">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 10">
<meta name=Originator content="Microsoft Word 10">
<link rel=File-List href="Cpp_overhead_files/filelist.xml">
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="country-region"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="place"/>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author> </o:Author>
  <o:Template>Normal</o:Template>
  <o:LastAuthor> </o:LastAuthor>
  <o:Revision>21</o:Revision>
  <o:TotalTime>565</o:TotalTime>
  <o:Created>2002-08-15T18:23:00Z</o:Created>
  <o:LastSaved>2012-04-29T04:22:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>1470</o:Words>
  <o:Characters>8384</o:Characters>
  <o:Company> </o:Company>
  <o:Lines>69</o:Lines>
  <o:Paragraphs>19</o:Paragraphs>
  <o:CharactersWithSpaces>9835</o:CharactersWithSpaces>
  <o:Version>10.3311</o:Version>
 </o:DocumentProperties>
 <o:OfficeDocumentSettings>
  <o:DoNotRelyOnCSS/>
 </o:OfficeDocumentSettings>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Zoom>75</w:Zoom>
  <w:GrammarState>Clean</w:GrammarState>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h1
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:1;
	font-size:16.0pt;
	font-family:Arial;
	mso-font-kerning:16.0pt;}
h3
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:3;
	font-size:13.0pt;
	font-family:Arial;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="16386">
  <o:colormenu v:ext="edit" fillcolor="white"/>
 </o:shapedefaults></xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body bgcolor=white lang=EN-US link=blue vlink=purple style='tab-interval:.5in'>

<div class=Section1>

<h1 align=center style='text-align:center'><b style='mso-bidi-font-weight:normal'><font
size=5 face=Arial><span style='font-size:16.0pt;mso-bidi-font-weight:normal'>C++:<span
style='mso-spacerun:yes'>  </span>More Bang, More Bucks, But No Blank Check<o:p></o:p></span></font></b></h1>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal align=center style='text-align:center'><font size=3
face=Arial><span style='font-size:12.0pt;font-family:Arial'>Copyright 2012
Walter William Karas<o:p></o:p></span></font></p>

<p class=MsoNormal align=center style='text-align:center'><font size=3
face=Arial><span style='font-size:12.0pt;font-family:Arial'>Copy freely, do not
remove copyright notice, and take credit/blame for any changes.<o:p></o:p></span></font></p>

<p class=MsoNormal align=center style='text-align:center'><font size=3
face=Arial><span style='font-size:12.0pt;font-family:Arial'>Version 1.2<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'>It&#8217;s common to hear software people call C++ a
&#8220;high overhead&#8221; language.<span style='mso-spacerun:yes'> 
</span>But rarely do you hear a specific explanation of why.<span
style='mso-spacerun:yes'>  </span>It&#8217;s true that, if you call a member
function in C++, it may not translate into a &#8220;call immediate&#8221;
instruction.<span style='mso-spacerun:yes'>  </span><span class=GramE>Whereas
in C, a function call (that doesn&#8217;t use a function pointer) <i
style='mso-bidi-font-style:normal'><span style='font-style:italic;mso-bidi-font-style:
normal'>could</span></i> typically be expected to translate to a &#8220;call
immediate&#8221; machine instruction.</span><span style='mso-spacerun:yes'> 
</span>So does that mean C++ has high overhead?<span style='mso-spacerun:yes'> 
</span>Consider a car.<span style='mso-spacerun:yes'>  </span>You have to stop
occasionally and buy fuel to put in your car.<span style='mso-spacerun:yes'> 
</span>You don&#8217;t have to do that with a bicycle.<span
style='mso-spacerun:yes'>  </span>But people (at least in the </span></font><st1:country-region><st1:place><font
  face=Arial><span style='font-family:Arial'>US</span></font></st1:place></st1:country-region><font
face=Arial><span style='font-family:Arial'>) are not in the habit of calling
their cars &#8220;high overhead&#8221;.<span style='mso-spacerun:yes'> 
</span>If A only does as much for you as B, but A takes more of your time,
money or other resources than B, then A can clearly be called high
overhead.<span style='mso-spacerun:yes'>  </span>But if A <i style='mso-bidi-font-style:
normal'><span style='font-style:italic;mso-bidi-font-style:normal'>also</span></i>
does more for you than B, then things are not so clear.<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'>Back in the early 1980&#8217;s, the buzzword
&#8220;object-oriented&#8221; seem to be most often associated with the
Smalltalk programming language.<span style='mso-spacerun:yes'>  </span>A major
goal of OO (or my sect of the OO religion at least) is greater reusability of
code.<span style='mso-spacerun:yes'>  </span>Inheritance was one way code could
be reused.<span style='mso-spacerun:yes'>  </span>A new type B could be create
by taking an existing type A and adding stuff to it, and existing code for A
could automatically be used for B.<span style='mso-spacerun:yes'>  </span>But
more importantly, if two types X and Y had some common set of<span
style='mso-spacerun:yes'>  </span>operations (with the same names, parameters
and &#8220;meanings&#8221;), then code that used only this common set of operations
could be used with objects (also known as variables, also known as instances)
of either type X or type Y.<span style='mso-spacerun:yes'>  </span>But this
flexibility came with a performance price &#8211; in Smalltalk, when a function
is called, its address has to be looked up in a hash table.<span
style='mso-spacerun:yes'>  </span>C++ (following the example of Simula) did not
want to pay this price, so it made a compromise.<span
style='mso-spacerun:yes'>  </span>It limited itself to the first sort of code
reuse, using inheritance, to eliminate the need for looking up called functions
in a hash table.<span style='mso-spacerun:yes'>  </span>You can tell a goal is
truly important when big sacrifices are made to reach it, so this shows you
that minimizing overhead is an important goal in the design of C++.<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'>(When you can write code that will work for any type sharing
an implicit common interface, as in Smalltalk, the implicit common interface is
often called a &#8220;duck type&#8221;.<span style='mso-spacerun:yes'> 
</span>The term comes from the expression &#8220;if it quacks like a duck, it
is one&#8221;.<span style='mso-spacerun:yes'>  </span>Because the effective
definition of the implicit interface to the type that is required in order to
work with the reused code is that the type works with the reused code.<span
style='mso-spacerun:yes'>  </span>C++ mostly recuperated the ability to code to
an implicit interface when templates were added to the language.<span
style='mso-spacerun:yes'>  </span>But templates have issues and complexities
that languages like Smalltalk don&#8217;t have.)<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'>In C++, if (non-template) code is going to work on objects
of two different types X and Y, then X and Y need to have a common
&#8220;base&#8221; class Z.<span style='mso-spacerun:yes'>  </span><span
class=GramE>(&#8220;Base&#8221; in quotes because Z could be either X or Y.)</span><span
style='mso-spacerun:yes'>  </span>But this is made much less limiting by the
mechanism of virtual member functions.<span style='mso-spacerun:yes'>  </span><span
class=GramE>The common code that works for both X and Y is interfacing formally
with an object of type Z.</span><span style='mso-spacerun:yes'>  </span>But
when this common code invokes one of Z&#8217;s member functions/operations,
this can result in code specific to the &#8220;real&#8221; type of the object,
X or Y, being executed.<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'>C++, unlike Smalltalk, allows for multiple base classes
(multiple <span class=GramE>inheritance</span>).<span
style='mso-spacerun:yes'>  </span>This has many advantages, because like many
good things, inheritance is a good thing that&#8217;s often worth doing more
than once.<span style='mso-spacerun:yes'>  </span>But the crucial need for
multiple <span class=GramE>inheritance</span> is to allow a class to have more
shared interfaces.<span style='mso-spacerun:yes'>  </span>Multiple <span
class=GramE>inheritance</span> does add a lot of picayune complexity to
C++.<span style='mso-spacerun:yes'>  </span>That&#8217;s probably why Java
chose a very limited form of multiple inheritance &#8211; one inherited class, <span
class=GramE>but<span style='mso-spacerun:yes'>  </span>many</span> inherited
&#8220;interfaces&#8221;.<span style='mso-spacerun:yes'>  </span>A Java
interface is a class that&#8217;s all hat and no cattle.<span
style='mso-spacerun:yes'>  </span>It has member function prototypes, but no
function bodies and no member variables. <span
style='mso-spacerun:yes'> </span>This does eliminate some language complexity
(Java does not have virtual base classes).<span style='mso-spacerun:yes'> 
</span>But it also limits the use of inheritance as a mechanism for reusing
internal class code, in addition to code that is not in the class but uses it.<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'>Consider this small sample of C++ code:<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><span class=GramE><font size=3 face="Courier New"><span
style='font-size:12.0pt;font-family:"Courier New"'>class</span></font></span><font
face="Courier New"><span style='font-family:"Courier New"'> A<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span>{<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span><span
class=GramE>private</span>:<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span><span
class=GramE>int</span> m, n;<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span><span
class=GramE>public</span>:<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span><span
class=GramE>void</span> f();<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span><span
class=GramE>virtual</span> void g(int i);<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span>};<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><span class=GramE><font size=3 face="Courier New"><span
style='font-size:12.0pt;font-family:"Courier New"'>class</span></font></span><font
face="Courier New"><span style='font-family:"Courier New"'> B : public A<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span>{<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span><span
class=GramE>private</span>:<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span><span
class=GramE>int</span> s;<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span><span
class=GramE>public</span>:<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span><span
class=GramE>virtual</span> void g(int i);<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span><span
class=GramE>virtual</span> void h(void);<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span>};<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><span class=GramE><font size=3 face="Courier New"><span
style='font-size:12.0pt;font-family:"Courier New"'>void</span></font></span><font
face="Courier New"><span style='font-family:"Courier New"'> foo(A *bp)<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span>{<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span>B b;<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span><span
class=GramE>b.f(</span>);<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span><span
class=GramE>b.g(</span>5);<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span><span
class=GramE>bp</span>-&gt;g(5);<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span>}<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'>The object code that would result from this code would have
similarity to the object code that would result from this C code:<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><span class=GramE><font size=3 face="Courier New"><span
style='font-size:12.0pt;font-family:"Courier New"'>struct</span></font></span><font
face="Courier New"><span style='font-family:"Courier New"'> A<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span>{<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span><span
class=GramE>int</span> m, n;<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span><span
class=GramE>const</span> void *v_struct_p;<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span>};<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><span class=GramE><font size=3 face="Courier New"><span
style='font-size:12.0pt;font-family:"Courier New"'>void</span></font></span><font
face="Courier New"><span style='font-family:"Courier New"'> A_f(A *a);<o:p></o:p></span></font></p>

<p class=MsoNormal><span class=GramE><font size=3 face="Courier New"><span
style='font-size:12.0pt;font-family:"Courier New"'>void</span></font></span><font
face="Courier New"><span style='font-family:"Courier New"'> A_g(A *a, int i);<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><span class=GramE><font size=3 face="Courier New"><span
style='font-size:12.0pt;font-family:"Courier New"'>struct</span></font></span><font
face="Courier New"><span style='font-family:"Courier New"'> A_v_struct<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span>{<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span><span
class=GramE>void</span> (*g)(int i);<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span>};<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><span class=GramE><font size=3 face="Courier New"><span
style='font-size:12.0pt;font-family:"Courier New"'>const</span></font></span><font
face="Courier New"><span style='font-family:"Courier New"'> struct A_v_struct
A_v_st = { A_g };<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><span class=GramE><font size=3 face="Courier New"><span
style='font-size:12.0pt;font-family:"Courier New"'>struct</span></font></span><font
face="Courier New"><span style='font-family:"Courier New"'> B<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span>{<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span><span
class=GramE>struct</span> A a;<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span><span
class=GramE>int</span> s;<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span>};<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><span class=GramE><font size=3 face="Courier New"><span
style='font-size:12.0pt;font-family:"Courier New"'>void</span></font></span><font
face="Courier New"><span style='font-family:"Courier New"'> B_g(A *a, int i);<o:p></o:p></span></font></p>

<p class=MsoNormal><span class=GramE><font size=3 face="Courier New"><span
style='font-size:12.0pt;font-family:"Courier New"'>void</span></font></span><font
face="Courier New"><span style='font-family:"Courier New"'> B_h(void);<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><span class=GramE><font size=3 face="Courier New"><span
style='font-size:12.0pt;font-family:"Courier New"'>struct</span></font></span><font
face="Courier New"><span style='font-family:"Courier New"'> B_v_struct<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span>{<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span><span
class=GramE>struct</span> A_v_struct as;<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span><span
class=GramE>void</span> (*h)();<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span>};<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><span class=GramE><font size=3 face="Courier New"><span
style='font-size:12.0pt;font-family:"Courier New"'>const</span></font></span><font
face="Courier New"><span style='font-family:"Courier New"'> struct B_v_struct
B_v_st = { { B_g }, B_h };<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><span class=GramE><font size=3 face="Courier New"><span
style='font-size:12.0pt;font-family:"Courier New"'>void</span></font></span><font
face="Courier New"><span style='font-family:"Courier New"'> foo(struct A *ap)<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span>{<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span><span
class=GramE>struct</span> B b;<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>   
</span>b.a.v_struct = &amp;B_v_st;<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span>A_<span
class=GramE>f(</span>&amp;b.a);<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span>B_<span
class=GramE>g(</span>&amp;b.a, 5);<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span>(((const
struct A_v_struct *) (ap-&gt;v_struct_p)<span class=GramE>)-</span>&gt;g)(<span
class=GramE>ap</span>, 5);<span style='mso-spacerun:yes'>  </span>// *<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face="Courier New"><span style='font-size:12.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>  </span>}<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'>The line of the code with <span class=GramE>the<span
style='mso-spacerun:yes'>  </span>/</span>/ * comment illustrates the cost of a
call to a virtual member function.<span style='mso-spacerun:yes'> 
</span>Notice there is no hash table to be found.<span
style='mso-spacerun:yes'>  </span>The cost is more than for a
&#8220;normal&#8221; function call but it&#8217;s not huge.<span
style='mso-spacerun:yes'>  </span>And note that the cost is only incurred when
the virtual function is called through a pointer (or reference).<span
style='mso-spacerun:yes'>  </span>It&#8217;s not incurred for the first call to
the member function B::<span class=GramE>g(</span>).<span
style='mso-spacerun:yes'>  </span>Every base class (that is not also a derived
class) with virtual member functions (and/or virtual base classes) has the
overhead of a hidden pointer to the appropriate &#8220;V struct&#8221; (V for
virtual).<span style='mso-spacerun:yes'>  </span>The &#8220;V struct&#8221;
gets bigger with more virtual functions, but there is (at most) <i
style='mso-bidi-font-style:normal'><span style='font-style:italic;mso-bidi-font-style:
normal'>one </span></i>&#8220;V struct&#8221; instance needed per class.<span
style='mso-spacerun:yes'>  </span>The expression of C++ features in object code
can be clever and tricky.<span style='mso-spacerun:yes'>  </span>But it&#8217;s
not that hard to get your head around the rough relative <span class=GramE>cost
,</span> in space and execution time, of using a feature in a particular
case.<span style='mso-spacerun:yes'>  </span>Using a C++ feature never gives
the compiler a blank check to <span class=GramE>insert<span
style='mso-spacerun:yes'>  </span>unpredictable</span> quantities of slow
object code, as some seem to fear.<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'>(Side note:<span style='mso-spacerun:yes'>  </span>you will
hear the rule of thumb &#8220;always make destructors virtual&#8221;.<span
style='mso-spacerun:yes'>  </span>I think there are even some compilers that
will issue a warning if a destructor isn&#8217;t <span class=GramE>virtual</span>.<span
style='mso-spacerun:yes'>  </span>This is because, if an object is allocated
using new, then freed by delete with a pointer to a base class, the base
class&#8217;s destructor will be called, not the destructor for the full
derived class.<span style='mso-spacerun:yes'>  </span>So if there isn&#8217;t
already something virtual in the class, think whether you really need, or want
for future safety, to make the destructor virtual and thus incur the overhead
of a hidden pointer in every instance of the class.)<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'>And then of course there are templates.<span
style='mso-spacerun:yes'>  </span>There are lots of good reasons to be
terrified of templates, but using templates does not by itself cause any
performance penalty.<span style='mso-spacerun:yes'>  </span><span class=GramE>None,
zero, zip.</span><span style='mso-spacerun:yes'>  </span>The C macro processor
(in Standard C) conceptually runs after tokenization but before parsing.<span
style='mso-spacerun:yes'>  </span>Templates are like macros that run after
parsing but before object code generation.<span style='mso-spacerun:yes'> 
</span>They are generally <i style='mso-bidi-font-style:normal'><span
style='font-style:italic;mso-bidi-font-style:normal'>much</span></i> more
convenient to use than equivalent macros.<span style='mso-spacerun:yes'> 
</span>But often one encounters some esoteric and picayune rules when using
templates, and even more so when writing them.<span style='mso-spacerun:yes'> 
</span>C++ compilers have very very painful error messages for mistakes
involving templates.<span style='mso-spacerun:yes'>  </span>A C++ compiler is
doing well if its template-related diagnostics are merely very paintul.<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'>In C, code is often made reusable by using void
pointers.<span style='mso-spacerun:yes'>  </span>But this leads to a lot of
casting, and thus to errors that the compiler can&#8217;t detect, and that are
hard to diagnose at runtime.<span style='mso-spacerun:yes'>  </span>You can
rewrite this code as a template, and all the casting will go away.<span
style='mso-spacerun:yes'>  </span>But, problem is, the old C version also
resulted in common <i style='mso-bidi-font-style:normal'><span
style='font-style:italic;mso-bidi-font-style:normal'>object</span></i> code as
well as common source code.<span style='mso-spacerun:yes'>  </span>Each time
you invoke a template, like a macro, it effectively takes the code in the
template definition, does the appropriate token substitution, and feeds it all
to the code generator.<span style='mso-spacerun:yes'>  </span>Thus there is no
sharing of object code.<span style='mso-spacerun:yes'>  </span>Often, it turns
out that the best compromise is to use a template or set of templates to create
a thin wrapper for the original C code with the void pointers.<span
style='mso-spacerun:yes'>  </span>The wrapper will contain all the ugly,
error-prone casting.<span style='mso-spacerun:yes'>  </span>The big advantage
being, you only have to get it right once.<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'>But perhaps the most fear-provoking feature in C+<span
class=GramE>+<span style='mso-spacerun:yes'>  </span>is</span> exceptions.<span
style='mso-spacerun:yes'>  </span>I personally have never used them.<span
style='mso-spacerun:yes'>  </span>It is <span class=GramE>possible,</span>
however, to implement exceptions in a way that there is no performance penalty
if an exception is not thrown.<span style='mso-spacerun:yes'>  </span>The compiler
can construct a hash table where the keys are all the possible return adresses
in the executable.<span style='mso-spacerun:yes'>  </span>When an exception is
thrown, the destructors of the objects in each stack frame must be called, up
to the stack frame where the exception is caught.<span
style='mso-spacerun:yes'>  </span>Each stack frame contains the return address
within the calling function, which is looked up in the aforementioned
table.<span style='mso-spacerun:yes'>  </span>The result of the table lookup is
a pointer to code that calls the destructors of the objects that exist in the
calling function at the point of the return address.<span
style='mso-spacerun:yes'>  </span>So clearly, using exceptions could
potentially bulk up the <i style='mso-bidi-font-style:normal'><span
style='font-style:italic;mso-bidi-font-style:normal'>size </span></i>of an
executable a great deal, <span class=GramE>but<span style='mso-spacerun:yes'> 
</span>not</span> necessarily the execution time.<span
style='mso-spacerun:yes'>  </span>I think it&#8217;s the case that GNU C++ uses
this approach to exceptions.<span style='mso-spacerun:yes'>  </span>I&#8217;ve
heard that Microsoft C++ uses an imlementation that does have a significant
preformance cost even if you never throw, but this information may be out of
date.<o:p></o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

<p class=MsoNormal><font size=3 face=Arial><span style='font-size:12.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></font></p>

</div>

</body>

</html>
